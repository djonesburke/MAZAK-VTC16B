o<orientspindle> sub

; Stop spindle and orient to 0°
M5
G4 P0.25 ; Dwell for spindle to stop completely

; SAFETY CHECK: Verify tool is clamped before orientation
; Mechanical crash will occur if drawbar is unclamped during spindle rotation
M66 P5 L3 Q0.5 ; Check clamp sensor (P5 = X10-tool-clamped)
o95 if [#5399 EQ 0]
    (msg, ERROR: Tool is not clamped. Cannot orient spindle safely.)
    (debug, SAFETY ABORT: Spindle orientation requires clamped tool)
    o<orientspindle> return [0]
o95 endif

; Orient spindle to 0° (T-slot position)
M19 R0

; Wait for spindle orientation to complete
M66 P6 L3 Q3 ; Wait up to 3 seconds for orientation sensor (P6)
o100 if [#5399 EQ 0]
    (msg, ERROR: Spindle orientation failed)
    (debug, Spindle orientation timeout)
    o<orientspindle> return [0]
o100 endif

;(debug, Spindle orientation complete)
o<orientspindle> endsub [1]

M2